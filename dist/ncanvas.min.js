/* ncanvas - v0.1.0 - 2013-06-08
 * http://nulrich.github.com/ncanvas
 * Copyright (c) 2013 Nicolas Ulrich
 * Licensed MIT */
var $nc=function(e,t){function v(e){p=e.pageX-s.offsetLeft,d=e.pageY-s.offsetTop}function m(e){return i.push(e),e}function g(e){return l.push(e),e}function y(e){if(e===undefined)return;var t=i.indexOf(e);if(t===-1)return;i.splice(t,1)}function b(e){if(e===undefined)return;var t=l.indexOf(e);if(t===-1)return;l.splice(t,1)}function w(e){var t={isRunning:!0};return t.tick=e,t}function E(e,t){o.translate(e,t)}function S(e,t){var n=e.getCenter(),r=n[0],i=n[1];o.translate(r,i),o.rotate(t*(Math.PI/180)),o.translate(-r,-i)}function x(e,t,n){var r=e.getCenter(),i=r[0],s=r[1];o.translate(i,s),o.scale(t,n),o.translate(-i,-s)}function T(e,t,n,r){var i=L(e,t,n,r),s=[];return i.attr.type="layer",i.draw=function(e){o.save(),i.applyTransformation(),C(i.attr),i.attr.angle!==undefined&&S(i,i.attr.angle),j(s),o.beginPath(),o.rect(i.attr.x,i.attr.y,i.attr.width,i.attr.height),o.closePath(),o.restore()},i.rect=function(e,t,n,r){var i=L(e,t,n,r);return s.push(i),i},i}function N(){function s(t,n,r,i){i=t[n]>e.attr[n]?i:-i;var s=Math.abs(e.attr[n]-t[n]),o=Math.abs(Math.round(s/i)),u=0;return function(s){if(u++===o)return e.attr[n]=t[n],r!==undefined&&r.apply(e,[n]),b(s);e.attr[n]=e.attr[n]+i}}function o(e){t.push(e)}var e={},t=[],r={},i={};return e.attr={visible:!0,stroke:!1,fill:!0,font:"italic 30px verdana"},e.tick=function(t){e.onTick=t},e.onMouseDown=function(t){e.down=t},e.onMouseOver=function(t){e.over=t},e.onMouseOut=function(t){e.out=t},e.applyTransformation=function(){for(var e in t)t[e]()},e.translate=function(t,n){return o(function(){E(t,n)}),e},e.rotate=function(t){return o(function(){S(e,t)}),e},e.scale=function(t,n){return o(function(){x(e,t,n)}),e},e.transition=function(t,i,o){typeof i=="function"&&(o=i,i=1),i===undefined&&(i=1);for(var u in t){var a=w(s(t,u,o,i));r[n](u)&&(b(r[u]),delete r[u]),r[u]=a,g(a),o=undefined}return U(),e},e.attribute=function(t){for(var n in t)e.attr[n]=t[n];return e},e.getCenter=function(){return[0,0]},e}function C(e){e[n]("strokeStyle")&&(o.strokeStyle=e.strokeStyle),e[n]("fillStyle")&&(o.fillStyle=e.fillStyle),e[n]("lineWidth")&&(o.lineWidth=e.lineWidth),e[n]("lineCap")&&(o.lineCap=e.lineCap),e[n]("lineJoin")&&(o.lineJoin=e.lineJoin),e[n]("globalAlpha")&&(o.globalAlpha=e.globalAlpha),e[n]("shadowColor")&&(o.shadowColor=e.shadowColor),e[n]("shadowBlur")&&(o.shadowBlur=e.shadowBlur),e[n]("shadowOffsetX")&&(o.shadowOffsetX=e.shadowOffsetX),e[n]("shadowOffsetY")&&(o.shadowOffsetY=e.shadowOffsetY),e[n]("font")&&(o.font=e.font),e[n]("textBaseline")&&(o.textBaseline=e.textBaseline),e[n]("textAlign")&&(o.textAlign=e.textAlign),e[n]("globalCompositeOperation")&&(o.globalCompositeOperation=e.globalCompositeOperation)}function k(e,t,n,r){var i=N();return i.attr.type="line",i.attr.s_x=e,i.attr.s_y=t,i.attr.e_x=n,i.attr.e_y=r,i.draw=function(e){o.save(),C(i.attr),i.applyTransformation(),o.beginPath(),o.moveTo(i.attr.s_x,i.attr.s_y),o.lineTo(i.attr.e_x,i.attr.e_y),e||o.stroke(),o.restore()},i.getCenter=function(){var e=Math.abs((i.attr.s_x-i.attr.d_x)/2),t=Math.abs((i.attr.s_y-i.attr.d_y)/2);return[e,t]},i}function L(e,t,n,r){var i=N();return i.attr.type="rect",i.attr.x=e,i.attr.y=t,i.attr.width=n,i.attr.height=r,i.draw=function(e){o.save(),i.applyTransformation(),C(this.attr),i.attr.angle!==undefined&&S(this,i.attr.angle),o.beginPath(),o.rect(this.attr.x,this.attr.y,this.attr.width,this.attr.height),o.closePath(),i.attr.stroke&&!e&&o.stroke(),i.attr.fill&&!e&&o.fill(),o.restore()},i.getCenter=function(){var e=i.attr.x+i.attr.width/2,t=i.attr.y+i.attr.height/2;return[e,t]},i}function A(e,t,n){var r=N();return r.attr.type="text",r.attr.x=e,r.attr.y=t,r.attr.txt=n,r.draw=function(n){if(n)return;o.save(),C(this.attr),r.applyTransformation(),r.attr.fill&&!n&&o.fillText(r.attr.txt,e,t),o.restore()},r}function O(e){var t=N();return t.attr.type="path",t.draw=function(n){o.save(),C(this.attr),t.applyTransformation(),o.beginPath();var r=e.match(/[A-Z][\s\d,-.]*/gi);for(var i in r){var s=r[i];I[s[0]](s.slice(1))}n||o.stroke(),o.restore()},t}function M(e,t,r,i,s){var u=N();return u.attr.type="circle",u.attr.x=e,u.attr.y=t,u.attr.r=r,u.attr.s=i,u.attr.e=s,u.draw=function(e){o.save(),C(this.attr),u.applyTransformation();if(this.attr[n]("gradient")){var t=o.createRadialGradient(this.attr.x,this.attr.y,0,this.attr.x,this.attr.y,this.attr.r);for(var r=0;r<this.attr.gradient.steps.length;r++)t.addColorStop(this.attr.gradient.steps[r],this.attr.gradient.colors[r]);o.fillStyle=t}o.beginPath();var i=this.attr.s*(Math.PI/180),s=this.attr.e*(Math.PI/180);this.attr.fill&&o.lineTo(this.attr.x,this.attr.y),o.arc(this.attr.x,this.attr.y,this.attr.r,i,s),this.attr.fill&&o.lineTo(this.attr.x,this.attr.y),this.attr.stroke&&!e&&o.stroke(),this.attr.fill&&!e&&o.fill(),o.restore()},u}function B(e){if(a)return;window.requestNextAnimationFrame(B),_=Date.now(),H=_-D;if(H<P&&e!==undefined)return;D=_-H%P,o.clearRect(0,0,1e3,1e3),o.save(),o.beginPath();for(var t in l)l[t].isRunning&&l[t].tick(l[t]);C(u),j(i),o.restore(),a=!0;for(t in l)if(l[t].isRunning){a=!1;break}}function j(e){for(var t in e){var n=e[t];if(!n.attr.visible)continue;n.draw(!0),c&&o.isPointInPath(p,d)&&n.down!==undefined&&n.down(p,d),h&&!n.isOver&&o.isPointInPath(p,d)&&(n.isOver=!0,n.over!==undefined&&n.over()),h&&n.isOver&&!o.isPointInPath(p,d)&&(n.isOver=!1,n.out!==undefined&&n.out())}for(t in e){var r=e[t];r.attr.visible&&r.draw(!1)}}function F(e){}function q(e){var t,n=e.lastIndexOf("-");return n!==1&&n>0?t=[e.slice(0,n),e.slice(n,e.length)]:t=e.split(","),F("coord "+t[0]+" "+t[1]),t}function R(e,t,n,r,i){F("rotate "+e+" "+t+" "+n+" "+r);var s=i*(Math.PI/180),o=Math.cos(s),u=Math.sin(s),a=e-n,f=t-r,l=n+a*o-f*u,c=r+a*u+f*o;return F("rotate "+l+" "+c),[l,c]}function U(){if(!a)return;a=!1,B()}var n="hasOwnProperty",r={},i=[],s=e,o=s.getContext("2d"),u=t||{},a=!0,f=!1,l=[],c=0,h=0,p=0,d=0;s.onmouseup=function(e){c=0},s.onmousedown=function(e){if(c)return;c=1,v(e),U()},s.onmouseover=function(e){h=1},s.onmouseout=function(e){h=0},s.onmousemove=function(e){v(e),U()};var _,D=Date.now(),P=1e3/30,H,I={x:0,y:0,c_x1:0,c_y1:0,c_x2:0,c_y2:0,s_x2:0,s_y2:0,s_x1:0,s_y1:0,s_x:0,s_y:0,q_x1:0,q_y1:0,q_x:0,q_y:0,t_x1:0,t_y1:0,t_x:0,t_y:0,M:function(e){var t=e.split(",");this.x=parseFloat(t[0]),this.y=parseFloat(t[1]),o.moveTo(this.x,this.y),F("Move x:"+this.x+" y:"+this.y)},L:function(e){var t=q(e);this.x=parseFloat(t[0]),this.y=parseFloat(t[1]),o.lineTo(this.x,this.y),F("LineTo x:"+this.x+" y:"+this.y)},l:function(e){var t=q(e);this.x+=parseFloat(t[0]),this.y+=parseFloat(t[1]),o.lineTo(this.x,this.y),F("lineTo x:"+this.x+" y:"+this.y)},Z:function(){o.closePath(),F("Close Path")},z:function(){o.closePath(),F("Close Path")},V:function(e){this.y=parseFloat(e),o.lineTo(this.x,this.y),F("Vertical x:"+this.x+" y:"+this.y)},v:function(e){this.y+=parseFloat(e),o.lineTo(this.x,this.y),F("Vertical x:"+this.x+" y:"+this.y)},H:function(e){this.x=parseFloat(e),o.lineTo(this.x,this.y),F("Horizontal x:"+this.x+" y:"+this.y)},h:function(e){this.x+=parseFloat(e),o.lineTo(this.x,this.y),F("Horizontal x:"+this.x+" y:"+this.y)},C:function(e){var t=e.match(/\d*[,]\d*/gi);this.c_x1=parseFloat(t[0].split(",")[0]),this.c_y1=parseFloat(t[0].split(",")[1]),this.c_x2=parseFloat(t[1].split(",")[0]),this.c_y2=parseFloat(t[1].split(",")[1]),this.c_x=parseFloat(t[2].split(",")[0]),this.c_y=parseFloat(t[2].split(",")[1]),o.moveTo(this.x,this.y),o.lineTo(this.c_x1,this.c_y1),o.moveTo(this.c_x,this.c_y),o.lineTo(this.c_x2,this.c_y2),o.moveTo(this.x,this.y),o.bezierCurveTo(this.c_x1,this.c_y1,this.c_x2,this.c_y2,this.c_x,this.c_y),F("Curve "+this.c_x1+" "+this.c_y1+" "+this.c_x2+" "+this.c_y2+" "+this.c_x+" "+this.c_y)},c:function(e){var t=e.match(/\d*[,]\d*/gi);this.c_x1=parseFloat(t[0].split(",")[0]),this.c_y1=parseFloat(t[0].split(",")[1]),this.c_x2=parseFloat(t[1].split(",")[0]),this.c_y2=parseFloat(t[1].split(",")[1]),this.c_x=parseFloat(t[2].split(",")[0]),this.c_y=parseFloat(t[2].split(",")[1]),o.moveTo(this.x,this.y),o.lineTo(this.c_x1,this.c_y1),o.moveTo(this.c_x,this.c_y),o.lineTo(this.c_x2,this.c_y2),o.moveTo(this.x,this.y),o.bezierCurveTo(this.c_x1,this.c_y1,this.c_x2,this.c_y2,this.c_x,this.c_y),F("Curve "+this._x1+" "+this.c_y1+" "+this.c_x2+" "+this.c_y2+" "+this.c_x+" "+this.c_y)},S:function(e){var t=e.match(/\d*[,]\d*/gi);this.s_x2=parseFloat(t[0].split(",")[0]),this.s_y2=parseFloat(t[0].split(",")[1]),this.s_x=parseFloat(t[1].split(",")[0]),this.s_y=parseFloat(t[1].split(",")[1]);var n=R(this.c_x2,this.c_y2,this.c_x,this.c_y,180);this.s_x1=parseFloat(n[0]),this.s_y1=parseFloat(n[1]),o.moveTo(this.c_x,this.c_y),o.lineTo(this.s_x1,this.s_y1),o.moveTo(this.s_x,this.s_y),o.lineTo(this.s_x2,this.s_y2),o.moveTo(this.c_x,this.c_y),o.bezierCurveTo(this.s_x1,this.s_y1,this.s_x2,this.s_y2,this.s_x,this.s_y),F("Curve "+this.s_x1+" "+this.s_y1+" "+this.s_x2+" "+this.s_y2+" "+this.s_x+" "+this.s_y)},Q:function(e){var t=e.match(/\d*[,]\d*/gi);this.q_x1=parseFloat(t[0].split(",")[0]),this.q_y1=parseFloat(t[0].split(",")[1]),this.q_x=parseFloat(t[1].split(",")[0]),this.q_y=parseFloat(t[1].split(",")[1]),o.moveTo(this.x,this.y),o.lineTo(this.q_x1,this.q_y1),o.moveTo(this.q_x1,this.q_y1),o.lineTo(this.q_x,this.q_y),o.moveTo(this.x,this.y),o.quadraticCurveTo(this.q_x1,this.q_y1,this.q_x,this.q_y),F("Quadra "+t[0]+" "+t[1])},T:function(e){var t=e.match(/\d*[,]\d*/gi);this.t_x=parseFloat(t[0].split(",")[0]),this.t_y=parseFloat(t[0].split(",")[1]);var n=R(this.q_x1,this.q_y1,this.q_x,this.q_y,180);this.t_x1=n[0],this.t_y1=n[1],o.moveTo(this.q_x,this.q_y),o.lineTo(this.t_x1,this.t_y1),o.moveTo(this.t_x1,this.t_y1),o.lineTo(this.t_x,this.t_y),o.moveTo(this.q_x,this.q_y),o.quadraticCurveTo(this.t_x1,this.t_y1,this.t_x,this.t_y),F("Cubic "+this.t_x1+" "+this.t_y1+" "+this.t_x+" "+this.t_y)}};return r.size=function(e,t){return s.height=e,s.width=t,this},r.background=function(e){return s.style.backgroundColor=e,this},r.anim=function(e){var t=g(w(e));return U(),t},r.line=function(e,t,n,r){return m(k(e,t,n,r))},r.rect=function(e,t,n,r){return m(L(e,t,n,r))},r.text=function(e,t,n){return m(A(e,t,n))},r.path=function(e){return m(O(e))},r.layer=function(e,t,n,r){return m(T(e,t,n,r))},r.circle=function(e,t,n,r,i){return m(M(e,t,n,r,i))},r.clear=function(){return o.clearRect(0,0,s.height,s.width),this},r.repaint=function(){return U(),this},r.remove=function(e){return y(e),this},r.forEach=function(e,t){var n;for(n=0;n<i.length;n+=1)(t===undefined||t!==undefined&&i[n].attr.type===t)&&e(i[n])},r.createRadialGradient=function(e,t,n,r,i,s){return o.createRadialGradient(e,t,n,r,i,s)},r.createLinearGradient=function(e,t,n,r){return o.createLinearGradient(e,t,n,r)},r};window.requestNextAnimationFrame=function(){var e=undefined,t=undefined,n=undefined,r=0,i=navigator.userAgent,s=0,o=this;return window.webkitRequestAnimationFrame&&(t=function(e){e===undefined&&(e=+(new Date)),o.callback(e)},e=window.webkitRequestAnimationFrame,window.webkitRequestAnimationFrame=function(n,r){o.callback=n,e(t,r)}),window.mozRequestAnimationFrame&&(s=i.indexOf("rv:"),i.indexOf("Gecko")!=-1&&(r=i.substr(s+3,3),r==="2.0"&&(window.mozRequestAnimationFrame=undefined))),window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){var n,r;window.setTimeout(function(){n=+(new Date),e(n),r=+(new Date),o.timeout=1e3/30-(r-n)},o.timeout)}}();